---
title: "GPA Project"
author: "Nick Tandle"
date: "2/18/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

Packages:
```{r}
install.packages("rvest")
install.packages("stringr")
install.packages("readxl")
install.packages("dplyr")
install.packages("htmlwidgets")
```

```{r}
library("rvest")
library("stringr")
library("readxl")
library("dplyr")
library("htmlwidgets")
```


Getting Course GPA Dataset
```{r, eval=FALSE}
wade_datasetV2 <- read_excel("Wade_DatasetV2.xlsx",
                             sheet = "TestSpring2018")
```


Creation of URLs for extraction
```{r}
course_abbreviations= unique(wade_datasetV2$Subject)

final_course_urls= paste0("http://catalog.illinois.edu/courses-of-instruction/",tolower(course_abbreviations),"/")
```


Extracting credit hours from the URLs  of each course.

Not generalized yet:
```{r}
Course_credits =
  read_html(psyc) %>%
  html_nodes(".courseblocktitle") %>%
  html_text() %>%
  str_extract_all(, pattern = "credit:[:blank:][:digit:][:blank:]to[:blank:][:digit:]|credit:[:blank:][:digit:]")
```
Generalized:
```{r}
credit_function= function(x){
  tryCatch(
  read_html(x) %>%
  html_nodes(".courseblocktitle") %>%
  html_text() %>%
  str_extract_all(, pattern = "credit:[:blank:][:digit:][:blank:]to[:blank:][:digit:]|credit:[:blank:][:digit:]"),
  error = function(e) {NA})
  }
```

Extracting course abbreviation

Not generalized yet:
```{r}
Course_abbreviations=
read_html(psyc) %>%
  html_nodes(".courseblocktitle") %>%
  html_text() %>%
  str_extract_all(pattern= "PSYC[:blank:][:digit:]{3}") %>%
  str_replace_all(pattern = "[:blank:]", replacement = "")
```

Generalized:
```{r}
abb_function = function(x) {
  tryCatch(
    read_html(x) %>%
      html_nodes(".courseblocktitle") %>%
      html_text() %>%
      str_extract(pattern = "[:alpha:]{2,4}[:blank:][:digit:]{3}") %>%
      str_replace_all(pattern = "[:blank:]", replacement = ""),
    error = function(e) {NA}
  )
}
```


Extracting credit hour

extracting all course abbreviations and credit hours
```{r}
all_abbreviations= mapply(FUN = abb_function, final_course_urls)
all_credits= mapply(FUN = credit_function, final_course_urls)
```


creating dataframes for abbreviations and credits
```{r}

df_abb= data.frame(unlist(all_abbreviations))
df_credit= data.frame(unlist(all_credits))

df_abb_named= setNames(cbind(rownames(df_abb), df_abb, row.names= NULL),
                         c("url","abbreviation"))

df_credit_named= setNames(cbind(rownames(df_credit), df_credit, row.names= NULL),
                         c("url","credit"))
```


#Merginging data


Merging abb and credit data frames
```{r}
abb_credit_df= merge(x= df_abb_named, y= df_credit_named, by=c("url"))
```

Merging abb/credit data frame with gpa data set and cleaning
```{r}
total_course_info = merge(
  x = abb_credit_df,
  y = wade_datasetV2,
  by.x = "abbreviation",
  by.y = "ShortCourse",
  all.y = TRUE
)

total_course_info = subset(total_course_info, select = -c(`Credit Hours`))
```

continued cleaning of credit hour
```{r}
total_course_info$credit = str_replace(total_course_info$credit,
                                       pattern = "credit:[:blank:]",
                                       replacement = "")

as.numeric(total_course_info$credit)

```
















